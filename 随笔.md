
## 原型图

![[Pasted image 20230221101544.png]]

## 技术选型

- `React v18` 
- `TypeScript` 
- `pnpm` ( p 代表 `performance` , 高性能的 npm)
- `Vite` (比 webpack 更快的构建工具, 冷启动和热更新比 webpack 快百倍)
- `Json Server` ? ( 前端 mock 接口, 本地提供数据)
- `React-Query` (API 缓存库)
- `React-testing-libray` & `Jest` & `Vitest`  (测试框架)

## Tasking






## To be done

- [ ] Header 组件
- [ ] List 组件 
- [ ] Search Box 组件

## 总结

>[!tip] 预览地址 :  xxx





## note

### jsdom

> **jsdom** 是一个库，用于在单元测试时，模拟 dom 环境，从而将被测试的元素渲染出来，方便对 UI 进行测试

**vitest** 支持使用`jsdom`或 `happy-dom`这两个库来模拟 dom 环境


### testing-library-react

> Vitest 基于 Testing-Library 提供了测试、断言等 API 、jsdom 提供了模拟 dom 环境的能力


## vitest

`test`还有一个别称`it`，在 vitest 中使用`it`等同于使用`test`，我估计大概是因为`jest`中，创建测试用例的方法叫做`it`，这里为了降低上手成本也兼容了`jest`的语法。


对于 React 组件来说，外部输入就是`props`，内部状态就是`stat`




## 踩坑记录


### 'test' does not exist in type 'UserConfigExport'

```ts
文件顶部增加注释
/// <reference types="vitest" />
/// <reference types="vite/client" />
```

### Invalid Chai Property : toBeInTheDocument

> Property 'toBeInTheDocument' does not exist on type  `Assertion<any>`

`vitest` 默认没有` toBeInTheDocument` 方法， `toBeInTheDocument` 是 testing library 中的断言方法，vitest 默认不包含，因此我们需要配置一下初始化文件，继承 testing library 断言库，新建一个 `vitest-setup.ts `文件

```ts
import { vi, expect, afterEach } from "vitest";
import { cleanup } from "@testing-library/react";
import matchers, {
  TestingLibraryMatchers,
} from "@testing-library/jest-dom/matchers";

declare global {
  namespace Vi {
    interface JestAssertion<T = any>
      extends jest.Matchers<void, T>,
        TestingLibraryMatchers<T, void> {}
  }
}
// 继承 testing-library 的扩展 except
expect.extend(matchers);
// 全局设置清理函数，避免每个测试文件手动清理
afterEach(() => {
  cleanup();
});
```

`cleanup()` 是为了在每次 `render` 后清理 react dom 树，若不清理可能会导致内存泄漏和非“幂等”测试（这可能导致测试中难以调试的错误），详情请看[官方文档](https://link.juejin.cn/?target=https%3A%2F%2Ftesting-library.com%2Fdocs%2Freact-testing-library%2Fapi%23cleanup "https://testing-library.com/docs/react-testing-library/api#cleanup")

然后在 vitest.config.ts 中设置 setupFiles 文件路径

```ts
export default defineConfig({
  plugins: [react()],
  test: {
    environment: "jsdom",
 +   setupFiles: "./vitest-setup.ts",
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "."),
    },
  },
});
```


### 